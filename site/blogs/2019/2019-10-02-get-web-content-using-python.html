<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!--> <html lang="zh" class="no-js"> <!--<![endif]-->
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="../../../css/bootstrap.min-2.3.1.css">
	<link rel="stylesheet" type="text/css" href="../../../css/bootstrap-responsive.min.css">
	<link rel="stylesheet" type="text/css" href="../../../css/bootstrap-style.css">
    <link rel="stylesheet" type="text/css" href="../../../css/font-awesome.min.css">
	<link rel="stylesheet" type="text/css" href="../../../css/menu.css">
	<link rel="stylesheet" type="text/css" href="../../../css/blog.css">
    <link rel="stylesheet" type="text/css" href="../../../css/style.css">
	<link rel='stylesheet' type='text/css' href='../../../css/shCoreRDark.css'/>
	<link rel="shortcut icon" href="../../../img/logo.ico" />
    <title>GaoHR | Python网页爬虫IP被限制的解决方法</title>
	<style>
		
	</style>
</head>

<body>
	<!--head-->
	<div class="mainlogo">
		<a href="../../../index.html"><span class="g-left">G</span>aoHR</a>
		<img src="../../../img/head.png" class="headimg">
		<p><img src="../../../img/welcome.png" class="welcome"></p>
		<script src="http://pv.sohu.com/cityjson?ie=utf-8"></script>
		<div class="weather" id ="weather"></div>
	</div>
	<div class="container-fluid main-page">
		<div class="row-fluid">
			<div class="span2">
				<!--responsive menu-->
				<div id="mainmenu"></div>
			</div>
			<div class="span8">
				<!--breadcrumb-->
				<ol class="breadcrumb">
					<li><a href="../../../index.html"><i class="icon-home"></i> Home</a></li>
					<i class="icon-angle-right"></i>
					<a href="../../../Blogs.html"> Blog</a>
					<!--<li class="active">Blog</li>-->
				</ol>
				<!--正文-->
				<input id="blogid" style="display:none" value="2019100201">
				<div class="blogcontent alist">
					<h2>Python网页爬虫IP被限制的解决方法</h2>
					<h2><small>Solutions to IP Restriction in Web Page Crawling with Python</small></h2>
					<div class="blogtopinfo"><span id="blogtopinfo"></span></div>
					Python爬虫IP被限制的解决方法
引言
网络爬虫是用于数据采集的一门技术，可以自动高效地进行信息的获取与筛选。从技术手段来说，网络爬虫有多种实现方案，如Python、Java、...。使用Python也会有很多不同的技术方案（urllib、requests、...)，每种技术各有各的特点，只需掌握一种技术，其它便迎刃而解。
但是，网络爬虫的难点并不在于网络爬虫本身，而在于网页的分析与爬虫的反爬攻克问题。高强度、高频率地爬取网页信息常常会给网站的服务器带来巨大压力，因此在利用Python进行网页爬虫的时候，经常会遇到所要爬取的网站采取了反爬虫技术，同一个IP反复爬取一个网站，就很可能被限制IP，无法访问该网站。
本文不再具体介绍Python爬虫和网页分析的技术，网上教程资源很多，主要介绍在使用Python爬虫时遇到的IP被限制的问题，及其简单有效的解决方法。
反爬虫示例
以某房产网站为例，爬虫抓取网站内容时会出现以下错误页面，导致爬虫无法继续抓取原始页面数据。
 

常用的解决方法
1. 模拟浏览器访问
网上经常会看到有些爬虫代码会设置headers变量，这是用来模拟浏览器上网用的，因为有些网站设置的反爬虫机制，需要使用浏览器上网才可以访问。
headers的设置也非常简单。
首先，打开调试面板，找到自己浏览器发送请求时的headers，其中，User-agent是用来表示请求者的信息，可以搜集User-agent并保存，爬取过程中动态更换在User-agent，伪装成浏览器的形式。如下图所示。
 
然后，在爬虫代码中加入headers变量
import requests

url = "<url>"
headers = {'User-Agent': 'Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36'}
web_data = requests.get(url, headers=headers)
这样就能成功的爬取到部分网站的网页信息了。
2. 设置动态IP代理
通过设置模拟浏览器代理来访问获取页面内容，始终只有一个IP地址用来访问,用的多了同样也会被某些网站封掉。
所以设置动态IP代理进行访问成为一种反爬虫的更好策略，即通过其他的IP代替自己的IP进行网站访问。
免费的代理IP网站有很多，虽然这种网站都不会提供太多的代理IP，但足够我们使用了。本文以西刺代理的免费IP网站（www.xicidaili.com/nn/）为例，介绍一下在python中如何使用动态IP代理。
打开网站，可以看到这里有很多代理IP列表，总共超过30万条代理IP地址。
 
设置IP代理需要修改proxies变量，proxies变量的格式是一个字典：{‘http’: ‘http://xx.xx.xx.xx:xxxx‘}，需要注意的是，proxises有http与https两种，在爬取不同网站时我们需要选用不同类型的网站时选用不同的proxise。
http型：{‘http’: ‘http://42.84.226.65:8888‘}
https型：{‘https’: ‘http://124.193.37.5:8888‘}
然后，从代理IP列表随机抓取IP地址，组成proxies，代码如下。
import random
from bs4 import BeautifulSoup
def get_ip_list(url, headers):
    web_data = requests.get(url, headers=headers)
    soup = BeautifulSoup(web_data.text, 'html.parser')
    ips = soup.find_all('tr')
    ip_list = []
    for i in range(1, len(ips)):
        ip_info = ips[i]
        tds = ip_info.find_all('td')
        ip_list.append(tds[1].text + ':' + tds[2].text)
    return ip_list


def get_random_ip(ip_list):
    proxy_list = []
    for ip in ip_list:
        proxy_list.append('http://' + ip)
    proxy_ip = random.choice(proxy_list)
    # 注意此处修改http或https
    proxies = {'http': proxy_ip}
    return proxies

url = 'http://www.xicidaili.com/nn/'
headers = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.100 Safari/537.36'
}
ip_list = get_ip_list(url, headers=headers)
proxies = get_random_ip(ip_list)
这样，就可以在requests.get()函数中添加proxies参数，设置代理IP。
requests.get(url, headers=headers, proxies=proxies)
通过将获取代理IP的代码放置到合适的位置，实现实时动态的IP代理更新，每次抓取页面都可以获取新的IP，达到防止IP被限制的目的。




					<p>美国国防气象卫星计划Defense Meteorological Satellite Program（DMSP）是美国国防部极轨卫星项目，其轨道特点类似NOAA卫星，运行在高度约830公里的太阳同步轨道，扫描条带宽度3000 km，周期约101分钟，每天绕地球飞行14圈，得到4次全球覆盖图，分别是清晨、白天、黄昏和夜晚。</p>
					<p class="imginblog"><img src="2019-09-29-global-light-dmsp\img001.jpg"></p>
					<p class="g-color-blue">卫星传感器一般获取的主要是地表的太阳辐射反射信号，而DMSP/OLS传感器采集的是夜间灯光、火光等产生的辐射信号。</p>
					<p><b><li>数据介绍</li></b></p>
					<p>DMSP/OLS传感器在夜间工作，能探测到城市灯光甚至小规模居民地、车流等发出的低强度灯光，并使之区别于黑暗的乡村背景。该系列稳定夜光信号的合成产品去除了短时辐射源的影响，因此高亮度像元值覆盖的部分通常对应高密度人类居住和活动地。因此，DMSP/OLS夜间灯光指数影像成为了人类活动监测研究的良好数据源。</p>
					<p>DMSP/OLS夜间灯光影像能反映综合性信息，它涵盖了交通道路、居民地等与人口、城市等因子分布密切相关的信息。目前，DMSP/OLS夜间灯光影像主要用于城镇扩展研究，社会经济因子估算以及其它环境、灾害、渔业、能源等领域。</p>
					<p><b><li>数据参数</li></b></p>
					<p>空间范围：全球</p>
					<p>时间范围：2008-2013年</p>
					<p>空间分辨率：30弧秒（约1 km）</p>
					<p>数据类型：栅格</p>
					<p>投影坐标：GCS地理坐标系统</p>
					<p>数据像元值：夜光辐射信号，辐射亮度值取值范围1-63</p>
					<p>数据详细信息参考官方网址：<a href="https://ngdc.noaa.gov/eog/dmsp/dmsp.html" target="_blank">https://ngdc.noaa.gov/eog/dmsp/dmsp.html</a></p>
					<p>使用该数据要注意的问题：</p>
					<p class="g-color-red">饱和和溢出问题：由于OLS 传感器本身的缺陷，夜间灯光数据在灯光强度较高的城市中心会出现灯光饱和现象，即像元值增大到一定程度不再随着地面灯光强度的增加而继续增大的现象。</p>
					<p><b><li>数据快照</li></b></p>
					<p class="imginblog"><img src="2019-09-29-global-light-dmsp\img002.jpg"></p>
					<p class="imginblog"><img src="2019-09-29-global-light-dmsp\img003.jpg"></p>
					<p class="imginblog"><img src="2019-09-29-global-light-dmsp\img004.jpg"></p>
					<p class="imginblog"><img src="2019-09-29-global-light-dmsp\img005.jpg"></p>
					<hr>
					<p><b><li>数据下载</li></b></p>
					<div class="portlet box blue" style="width:60%;margin-left:20%;">
						<div class="portlet-title">
							<div class="caption">数据列表</div>
						</div>
						<div class="portlet-body">
							<table class="table table-hover">
								<thead><tr><th>编号</th><th>数据</th><th>类型</th><th>下载</th></tr></thead>
								<tbody>
									<tr><td>1</td><td>2008年全球夜间灯光指数</td><td>栅格</td><td><a href="http://gaohr.win/MyImages/data/DMSP/dmsp2008.rar"><img src="2019-09-13-china-soil-type/zip_icon.png"></a></td></tr>
									<tr><td>2</td><td>2009年全球夜间灯光指数</td><td>栅格</td><td><a href="http://gaohr.win/MyImages/data/DMSP/dmsp2009.rar"><img src="2019-09-13-china-soil-type/zip_icon.png"></a></td></tr>
									<tr><td>3</td><td>2010年全球夜间灯光指数</td><td>栅格</td><td><a href="http://gaohr.win/MyImages/data/DMSP/dmsp2010.rar"><img src="2019-09-13-china-soil-type/zip_icon.png"></a></td></tr>
									<tr><td>4</td><td>2011年全球夜间灯光指数</td><td>栅格</td><td><a href="http://gaohr.win/MyImages/data/DMSP/dmsp2011.rar"><img src="2019-09-13-china-soil-type/zip_icon.png"></a></td></tr>
									<tr><td>5</td><td>2012年全球夜间灯光指数</td><td>栅格</td><td><a href="http://gaohr.win/MyImages/data/DMSP/dmsp2012.rar"><img src="2019-09-13-china-soil-type/zip_icon.png"></a></td></tr>
									<tr><td>6</td><td>2013年全球夜间灯光指数</td><td>栅格</td><td><a href="http://gaohr.win/MyImages/data/DMSP/dmsp2013.rar"><img src="2019-09-13-china-soil-type/zip_icon.png"></a></td></tr>
								</tbody>
							</table>
						</div>
					</div>
					<br>
					<p>Fighting, GISer!</p>
					<!-- Warning -->
					<div id="warning"></div>
				</div>
				<!-- Da shang -->
				<div id="dashang" class="dashang"></div>
				<!-- Comments -->
				<div id="comments"></div>
			</div>
			<div class="span2">
				<div class="block"></div>
				<div class="portlet" id="declareDiv"></div>
				<div class="block"></div>
				<div class="portlet">
					<p class="title"><i class="icon-book"></i><b>最新博文</b></p>
					<br>
					<div class="blog-page" id="blogs"></div>
				</div>
				<!-- Share -->
				<div id="shareit"></div>
			</div>
		</div>
	</div>
	<!-- others  --> 
	<div id="others"></div>
	<!-- footer  --> 
	<footer>
		<p id="copyright" class="copyright"></p>
	</footer>
    <!-- JavaScript -->
    <script src="../../../js/jquery.min.js"></script>
    <script src="../../../js/bootstrap.min.js"></script>
	<script src="../../../js/bloglist.js"></script>
	<script src="../../special/js/topicslist.js"></script>
	<script src="../../../js/paylist.js"></script>
	<script src="../blogsload.js"></script>
	<script src="../../../js/common.js"></script>
</body>
</html>
